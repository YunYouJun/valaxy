import { webcrypto } from 'node:crypto'
import type { VitePluginConfig as UnoCssConfig } from 'unocss/vite'
import type { Awaitable } from '@antfu/utils'
import type { SiteConfig, UserSiteConfig } from '../../types'
import type { UserValaxyNodeConfig, ValaxyNodeConfig } from '../types'

export * from './addon'

/**
 * Type helper for site.config.ts
 * @param config
 */
export function defineSiteConfig(config: UserSiteConfig) {
  return config
}

/**
 * Type helper for valaxy.config.ts
 */
export function defineValaxyConfig<ThemeConfig>(config: UserValaxyNodeConfig<ThemeConfig>) {
  return config
}
export const defineConfig = defineValaxyConfig

export const defaultSiteConfig: SiteConfig = {
  mode: 'auto',
  url: '/',
  lang: 'en',
  languages: ['en', 'zh-CN'],
  timezone: '',
  title: 'Valaxy Blog',
  description: 'A blog generated by Valaxy.',
  subtitle: 'Next Generation Static Blog Framework.',
  author: {
    avatar: 'https://valaxy.site/valaxy-logo.png',
    email: 'i@valaxy.site',
    link: 'https://valaxy.site',
    name: 'VALAXY Developer',
    status: {
      emoji: 'üåå',
      message: 'The moonlight is beautiful.',
    },
  },
  favicon: '/favicon.svg',
  feed: {
    name: '',
    favicon: '/favicon.svg',
  },
  social: [],

  lastUpdated: true,

  license: {
    enabled: true,
    language: '',
    type: 'by-nc-sa',
  },

  sponsor: {
    enable: true,
    description: 'ËøôÊòØÂÖ≥‰∫éËµûÂä©ÁöÑ‰∏Ä‰∫õÊèèËø∞',
    methods: [],
  },

  search: {
    enable: false,
    type: 'fuse',
  },
  fuse: {
    dataPath: 'valaxy-fuse-list.json',
    options: {
      keys: [],
    },
  },

  comment: {
    enable: false,
  },

  cdn: {
    prefix: 'https://unpkg.com/',
  },

  mediumZoom: {
    enable: false,
    selector: '',
    options: {},
  },

  vanillaLazyload: {
    enable: false,
    options: {},
  },

  statistics: {
    enable: false,
    readTime: {
      speed: {
        cn: 300,
        en: 100,
      },
    },
  },

  pageSize: 7,

  encrypt: {
    enable: false,
    algorithm: 'AES-CBC',
    salt: webcrypto.getRandomValues(new Uint8Array(16)),
    iv: webcrypto.getRandomValues(new Uint8Array(16)),
  },
}

export const defaultValaxyConfig: ValaxyNodeConfig = {
  ignoreDeadLinks: true,

  siteConfig: defaultSiteConfig,
  theme: 'yun',
  themeConfig: {
    pkg: {
      name: '',
      version: '',
    },
  },

  // markdown: {
  //   excerpt: '<!-- more -->',
  // },
  runtimeConfig: { addons: {} },

  modules: {
    rss: {
      enable: true,
    },
  },

  features: {
    katex: true,
  },

  vite: {
    build: {
      rollupOptions: {
        external: [],
      },
    },
  },
}

export type UnoSetup = () => Awaitable<Partial<UnoCssConfig> | undefined>

export function defineUnoSetup(fn: UnoSetup) {
  return fn
}
